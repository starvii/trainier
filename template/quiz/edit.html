{% extends "base/skeleton.html" %}
{% block container %}
    {% raw %}
    <div id="app">
        <div class="columns">
            <div class="column is-4">
                <div class="field">
                    <label class="label">测验编码</label>
                    <p class="control">
                        <input class="input is-small" placeholder="code" v-model="quiz.code">
                    </p>
                </div>
            </div>
            <div class="column is-4">
                <div class="field">
                    <label class="label">测验名称</label>
                    <p class="control">
                        <input class="input is-small" placeholder="name" v-model="quiz.name">
                    </p>
                </div>
            </div>
            <div class="column is-2">
                <div class="field">
                    <label class="label">&nbsp;</label>
                    <p class="control">
                        <label class="checkbox">
                            <input type="checkbox" v-model="quiz.random_trunk">
                            <strong>随机题目顺序</strong>
                        </label>
                    </p>
                </div>
            </div>
            <div class="column is-2">
                <div class="field">
                    <label class="label">&nbsp;</label>
                    <p class="control">
                        <label class="checkbox">
                            <input type="checkbox" v-model="quiz.random_choice">
                            <strong>随机选项顺序</strong>
                        </label>
                    </p>
                </div>
            </div>
        </div>
        <div class="columns">
            <textarea rows="5" class="textarea is-small" readonly="readonly"
                                  v-model="quiz.question"></textarea>
        </div>
        <div class="columns">
            <div class="column">
                <table class="table is-striped is-narrow is-fullwidth is-hoverable">
                    <thead>
                    <tr>
                        <td colspan="5">
                            <page-component :conf.sync="pageConf"></page-component>
                        </td>
                    </tr>

                    <tr>
                        <td>
                            <label class="checkbox">
                                <input type="checkbox" v-model="onlySelect" @click="list()">
                                <strong>仅已选</strong>
                            </label>
                        </td>
                        <td colspan="3">
                            <input class="input is-small" type="text" v-model="kw" @keyup.enter="search()">
                        </td>
                        <td><a class="button is-small" title="查找" @click="search()">
                            <i class="fas fa-search"></i>
                        </a></td>
                    </tr>
                    <tr>
                        <th>选择</th>
                        <th>编号</th>
                        <th>编码</th>
                        <th>题目（英文）</th>
                        <th>题目（中文）</th>
                    </tr>
                    </thead>
                    <tfoot>
                    <tr>
                        <td colspan="5">
                            <page-component :conf.sync="pageConf"></page-component>
                        </td>
                    </tr>
                    </tfoot>
                    <tbody>
                    <tr v-for="(trunk, idx) in trunkList">
                        <td>
                            <input type="checkbox" @click="list()">
                        </td>
                        <td>
                            <a :href="`view#` + trunk.entity_id" target="_blank"
                               v-text="(pageConf.currentPage - 1) * pageConf.itemsPerPage + idx + 1"></a>
                        </td>
                        <td>
                            <a :href="`view#` + trunk.entity_id" target="_blank" v-text="trunk.code"></a>
                        </td>
                        <td colspan="2" v-if="trunk.x_trunk.length > 0">
                            <a :href="`view#` + trunk.entity_id" target="_blank" :title="trunk.x_trunk"
                               v-text="trunk.x_trunk_digest"></a>
                        </td>
                        <td v-if="trunk.x_trunk.length == 0">
                            <a :href="`view#` + trunk.entity_id" target="_blank" :title="trunk.en_trunk"
                               v-text="trunk.en_trunk_digest"></a>
                        </td>
                        <td v-if="trunk.x_trunk.length == 0">
                            <a :href="`view#` + trunk.entity_id" target="_blank" :title="trunk.cn_trunk"
                               v-text="trunk.cn_trunk_digest"></a>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <a class="button is-link is-success is-pulled-right" @click="save()">保存</a>
    </div>

    {% endraw %}
{% endblock %}
{% block script %}
    {% raw %}
    <script src="/js/page.js"></script>
    <script src="/js/common.js"></script>
    <script type="text/javascript">
        const app = new window.Vue({
            el: '#app',
            data: {
                quiz: {},
                trunkList: [],
                selectedTrunk: [],
                onlySelect: true,
                pageConf: {
                    currentPage: 1,
                    totalItems: 1000,
                    itemsPerPage: 10,
                    pagesLength: 9,
                    perPageOptions: [10, 15, 30, 50, 100],
                    onChange: 'list',
                },
                keyword: '',
                kw: '',
            },
            mounted: function () {
                let hsh = location.hash.trim();
                if (hsh[0] === '#') {
                    hsh = hsh.substring(1);
                    this.quiz.entity_id = hsh;
                    this.load();
                }
            },
            methods: {
                load: function () {

                },
                list: function () {
                    if (this.onlySelect) {
                        // 从 quiz.questions 中选择
                    } else {
                        // 从所有
                    }
                },
                save: function () {

                },
                search: function () {
                    if (this.keyword !== this.kw.trim()) {
                        this.keyword = this.kw.trim();
                        this.list();
                    }
                },
            },
        });
    </script>
    {% endraw %}
{% endblock %}
