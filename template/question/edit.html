{% extends "base/skeleton.html" %}
{% block container %}
    <div class="is-hidden">
        <input id="entityId" readonly="readonly" value="{{ entity_id }}">
    </div>
    {% raw %}
    <div class="columns" id="app">
        <div class="column" v-if="showResult">
            <form>
                <div class="field">
                    <label class="label">英文题目</label>
                    <div class="control">
                        <textarea rows="5" class="textarea is-small" placeholder="English Trunk" v-model="enTrunk"></textarea>
                    </div>
                </div>
                <div class="field">
                    <label class="label">中文题目</label>
                    <div class="control">
                        <textarea rows="3" class="textarea is-small" placeholder="Chinese Trunk" v-model="cnTrunk"></textarea>
                    </div>
                </div>
                <div class="field">
                    <label class="label">详解</label>
                    <div class="control">
                        <textarea rows="5" class="textarea is-small" placeholder="Explanation" v-model="analysis"></textarea>
                    </div>
                </div>
                <div class="field">
                    <div class="field-body">
                        <div class="field">
                            <p class="control is-expanded">
                                <textarea rows="3" class="textarea is-small" placeholder="source" v-model="analysis"></textarea>
                            </p>
                        </div>
                        <div class="field">
                            <p class="control is-expanded">
                                <textarea rows="3" class="textarea is-small" placeholder="comment" v-model="comment"></textarea>
                            </p>
                        </div>
                    </div>
                </div>
                <div class="field" v-for="(opt, index) in options">
                    <div class="field-body" @dblclick="changeAnswer(index)">
                        <div class="field">
                            <p class="control is-small">
                                <a class="button is-small is-pulled-left"><span><i class="fas fa-plus"></i></span></a>
                                <a class="button is-small is-pulled-left"><span><i class="fas fa-minus"></i></span></a>
                                <span class="is-pulled-right">A.</span>
                            </p>
                        </div>
                        <div class="field">
                            <p class="control has-icons-right">
                                <input class="input is-small" type="text" placeholder="English Option" v-model="opt.enOption"
                                       :class="[opt.isTrue ? 'is-success' : 'is-danger']">
                                <span class="icon is-small is-right">
                                    <i class="fas fa-check" v-if="opt.isTrue"></i>
                                    <i class="fas fa-times" v-if="!opt.isTrue"></i>
                                </span>
                            </p>
                        </div>
                        <div class="field">
                            <p class="control has-icons-right">
                                <input class="input is-small" type="text" placeholder="Chinese Option" v-model="opt.cnOption"
                                       :class="[opt.isTrue ? 'is-success' : 'is-danger']">
                                <span class="icon is-small is-right">
                                    <i class="fas fa-check" v-if="opt.isTrue"></i>
                                    <i class="fas fa-times" v-if="!opt.isTrue"></i>
                                </span>
                            </p>
                        </div>
                    </div>
                </div>
                <a class="button is-link is-success is-pulled-right" @click="save()">保存</a>
            </form>
        </div>
    </div>
    {% endraw %}
{% endblock %}
{% block script %}
    {% raw %}
    <!--
    <script src="/vue/vue.js" type="text/javascript"></script>
    <script src="/vue/resource/vue-resource.js" type="text/javascript"></script>
    -->
    <script type="text/javascript">
        window.Vue = Vue;
        const app = new Vue({
            el: '#app',
            data: {
                encodedTrunkId: '',
                enTrunk: '',
                cnTrunk: '',
                options: [],
                comment: '',
                analysis: '',
                source: '',
            },
            mounted: function() {
                app.encodedTrunkId = window.document.getElementById('entityId');
                //console.log(app.encodedTrunkId);
            },
            methods: {
                save: function () {
                    Vue.http.post(
                        '/api/import/save',
                        {
                            entityId: app.trunkId,
                            comment: app.comment,
                            analysis: app.analysis,
                            source: app.source,
                            enTrunk: app.enTrunk,
                            cnTrunk: app.cnTrunk,
                            level: 0,
                            options: app.options,
                        }
                    ).then(
                        function (response) {
                            if (response.ok) {
                                alert('保存成功');
                            } else {
                                alert('保存失败，请检查日志');
                            }

                        },
                        function (response) {
                            alert('保存失败，请检查日志');
                        }
                    );
                },
                changeAnswer: function (index) {
                    app.options[index].isTrue = !app.options[index].isTrue;
                },
            },
        });
    </script>
    {% endraw %}
{% endblock %}